"use strict";var flighty=function(){'use strict';var j=String.fromCharCode;function a(){}function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],i(a,this)}function d(a,b){for(;3===a._state;)a=a._value;return 0===a._state?void a._deferreds.push(b):void(a._handled=!0,c._immediateFn(function(){var c=1===a._state?b.onFulfilled:b.onRejected;if(null===c)return void(1===a._state?e:f)(b.promise,a._value);var d;try{d=c(a._value)}catch(a){return void f(b.promise,a)}e(b.promise,d)}))}function e(a,d){try{if(d===a)throw new TypeError("A promise cannot be resolved with itself.");if(d&&("object"==typeof d||"function"==typeof d)){var e=d.then;if(d instanceof c)return a._state=3,a._value=d,void g(a);if("function"==typeof e)return void i(b(e,d),a)}a._state=1,a._value=d,g(a)}catch(b){f(a,b)}}function f(a,b){a._state=2,a._value=b,g(a)}function g(a){2===a._state&&0===a._deferreds.length&&c._immediateFn(function(){a._handled||c._unhandledRejectionFn(a._value)});for(var b=0,e=a._deferreds.length;b<e;b++)d(a,a._deferreds[b]);a._deferreds=null}function h(a,b,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.promise=c}function i(a,b){var c=!1;try{a(function(a){c||(c=!0,e(b,a))},function(a){c||(c=!0,f(b,a))})}catch(a){if(c)return;c=!0,f(b,a)}}var k=setTimeout;c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(b,c){var e=new this.constructor(a);return d(this,new h(b,c,e)),e},c.prototype["finally"]=function(a){var b=this.constructor;return this.then(function(c){return b.resolve(a()).then(function(){return c})},function(c){return b.resolve(a()).then(function(){return b.reject(c)})})},c.all=function(a){return new c(function(b,c){function d(a,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(b){d(a,b)},c)}e[a]=g,0==--f&&b(e)}catch(a){c(a)}}if(!a||"undefined"==typeof a.length)throw new TypeError("Promise.all accepts an array");var e=Array.prototype.slice.call(a);if(0===e.length)return b([]);for(var f=e.length,g=0;g<e.length;g++)d(g,e[g])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},c._immediateFn="function"==typeof setImmediate&&function(a){setImmediate(a)}||function(a){k(a,0)},c._unhandledRejectionFn=function(a){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",a)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();l.Promise||(l.Promise=c);var m="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window;(function(a){(function(b){function c(a){return a&&DataView.prototype.isPrototypeOf(a)}function d(a){if("string"!=typeof a&&(a+=""),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function e(a){return"string"!=typeof a&&(a+=""),a}function f(a){var b={next:function(){var b=a.shift();return{done:void 0===b,value:b}}};return v.iterable&&(b[Symbol.iterator]=function(){return b}),b}function g(a){this.map={},a instanceof g?a.forEach(function(a,b){this.append(b,a)},this):Array.isArray(a)?a.forEach(function(a){this.append(a[0],a[1])},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function h(a){return a.bodyUsed?Promise.reject(new TypeError("Already read")):void(a.bodyUsed=!0)}function i(a){return new Promise(function(b,c){a.onload=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function k(a){var b=new FileReader,c=i(b);return b.readAsArrayBuffer(a),c}function l(a){var b=new FileReader,c=i(b);return b.readAsText(a),c}function m(a){for(var b=new Uint8Array(a),c=Array(b.length),d=0;d<b.length;d++)c[d]=j(b[d]);return c.join("")}function n(a){if(a.slice)return a.slice(0);var b=new Uint8Array(a.byteLength);return b.set(new Uint8Array(a)),b.buffer}function o(){return this.bodyUsed=!1,this._initBody=function(a){this._bodyInit=a,a?"string"==typeof a?this._bodyText=a:v.blob&&Blob.prototype.isPrototypeOf(a)?this._bodyBlob=a:v.formData&&FormData.prototype.isPrototypeOf(a)?this._bodyFormData=a:v.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)?this._bodyText=a.toString():v.arrayBuffer&&v.blob&&c(a)?(this._bodyArrayBuffer=n(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):v.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||x(a))?this._bodyArrayBuffer=n(a):this._bodyText=a=Object.prototype.toString.call(a):this._bodyText="",this.headers.get("content-type")||("string"==typeof a?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob&&(this.blob=function(){var a=h(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");else return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(k)}),this.text=function(){var a=h(this);if(a)return a;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");else return Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(r)}),this.json=function(){return this.text().then(JSON.parse)},this}function p(a){var b=a.toUpperCase();return-1<y.indexOf(b)?b:a}function q(a,b){b=b||{};var c=b.body;if(a instanceof q){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,b.headers||(this.headers=new g(a.headers)),this.method=a.method,this.mode=a.mode,this.signal=a.signal,c||null==a._bodyInit||(c=a._bodyInit,a.bodyUsed=!0)}else this.url=a+"";if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new g(b.headers)),this.method=p(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&c)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(c)}function r(a){var b=new FormData;return a.trim().split("&").forEach(function(a){if(a){var c=a.split("="),d=c.shift().replace(/\+/g," "),e=c.join("=").replace(/\+/g," ");b.append(decodeURIComponent(d),decodeURIComponent(e))}}),b}function s(a){var b=new g,c=a.replace(/\r?\n[\t ]+/g," ");return c.split(/\r?\n/).forEach(function(a){var c=a.split(":"),d=c.shift().trim();if(d){var e=c.join(":").trim();b.append(d,e)}}),b}function t(a,b){b||(b={}),this.type="default",this.status=void 0===b.status?200:b.status,this.ok=200<=this.status&&300>this.status,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new g(b.headers),this.url=b.url||"",this._initBody(a)}function u(a,c){return new Promise(function(d,e){function f(){h.abort()}var g=new q(a,c);if(g.signal&&g.signal.aborted)return e(new b.DOMException("Aborted","AbortError"));var h=new XMLHttpRequest;h.onload=function(){var a={status:h.status,statusText:h.statusText,headers:s(h.getAllResponseHeaders()||"")};a.url="responseURL"in h?h.responseURL:a.headers.get("X-Request-URL");var b="response"in h?h.response:h.responseText;d(new t(b,a))},h.onerror=function(){e(new TypeError("Network request failed"))},h.ontimeout=function(){e(new TypeError("Network request failed"))},h.onabort=function(){e(new b.DOMException("Aborted","AbortError"))},h.open(g.method,g.url,!0),"include"===g.credentials?h.withCredentials=!0:"omit"===g.credentials&&(h.withCredentials=!1),"responseType"in h&&v.blob&&(h.responseType="blob"),g.headers.forEach(function(a,b){h.setRequestHeader(b,a)}),g.signal&&(g.signal.addEventListener("abort",f),h.onreadystatechange=function(){4===h.readyState&&g.signal.removeEventListener("abort",f)}),h.send("undefined"==typeof g._bodyInit?null:g._bodyInit)})}var v={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(a){return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};if(v.arrayBuffer)var w=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],x=ArrayBuffer.isView||function(a){return a&&-1<w.indexOf(Object.prototype.toString.call(a))};g.prototype.append=function(a,b){a=d(a),b=e(b);var c=this.map[a];this.map[a]=c?c+", "+b:b},g.prototype["delete"]=function(a){delete this.map[d(a)]},g.prototype.get=function(a){return a=d(a),this.has(a)?this.map[a]:null},g.prototype.has=function(a){return this.map.hasOwnProperty(d(a))},g.prototype.set=function(a,b){this.map[d(a)]=e(b)},g.prototype.forEach=function(a,b){for(var c in this.map)this.map.hasOwnProperty(c)&&a.call(b,this.map[c],c,this)},g.prototype.keys=function(){var a=[];return this.forEach(function(b,c){a.push(c)}),f(a)},g.prototype.values=function(){var a=[];return this.forEach(function(b){a.push(b)}),f(a)},g.prototype.entries=function(){var a=[];return this.forEach(function(b,c){a.push([c,b])}),f(a)},v.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];q.prototype.clone=function(){return new q(this,{body:this._bodyInit})},o.call(q.prototype),o.call(t.prototype),t.prototype.clone=function(){return new t(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},t.error=function(){var a=new t(null,{status:0,statusText:""});return a.type="error",a};var z=[301,302,303,307,308];t.redirect=function(a,b){if(-1===z.indexOf(b))throw new RangeError("Invalid status code");return new t(null,{status:b,headers:{location:a}})},b.DOMException=a.DOMException;try{new b.DOMException}catch(a){b.DOMException=function(a,b){this.message=a,this.name=b;var c=Error(a);this.stack=c.stack},b.DOMException.prototype=Object.create(Error.prototype),b.DOMException.prototype.constructor=b.DOMException}return u.polyfill=!0,a.fetch||(a.fetch=u,a.Headers=g,a.Request=q,a.Response=t),b.Headers=g,b.Request=q,b.Response=t,b.fetch=u,b})({})})("undefined"==typeof self?m:self);var n=Object.prototype.hasOwnProperty,o=function(){for(var a=[],b=0;256>b;++b)a.push("%"+((16>b?"0":"")+b.toString(16)).toUpperCase());return a}(),p=function(a){for(;1<a.length;){var b=a.pop(),c=b.obj[b.prop];if(Array.isArray(c)){for(var d=[],e=0;e<c.length;++e)"undefined"!=typeof c[e]&&d.push(c[e]);b.obj[b.prop]=d}}},q=function(a,b){for(var c=b&&b.plainObjects?Object.create(null):{},d=0;d<a.length;++d)"undefined"!=typeof a[d]&&(c[d]=a[d]);return c},r={arrayToObject:q,assign:function(a,b){return Object.keys(b).reduce(function(a,c){return a[c]=b[c],a},a)},combine:function(c,a){return[].concat(c,a)},compact:function(a){for(var b=[{obj:{o:a},prop:"o"}],c=[],d=0;d<b.length;++d)for(var e=b[d],f=e.obj[e.prop],g=Object.keys(f),h=0;h<g.length;++h){var k=g[h],l=f[k];"object"==typeof l&&null!==l&&-1===c.indexOf(l)&&(b.push({obj:f,prop:k}),c.push(l))}return p(b),a},decode:function(a,b,c){var d=a.replace(/\+/g," ");if("iso-8859-1"===c)return d.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(d)}catch(a){return d}},encode:function(a,b,d){if(0===a.length)return a;var e="string"==typeof a?a:a+"";if("iso-8859-1"===d)return escape(e).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});for(var f,g="",h=0;h<e.length;++h){if(f=e.charCodeAt(h),45===f||46===f||95===f||126===f||48<=f&&57>=f||65<=f&&90>=f||97<=f&&122>=f){g+=e.charAt(h);continue}if(128>f){g+=o[f];continue}if(2048>f){g+=o[192|f>>6]+o[128|63&f];continue}if(55296>f||57344<=f){g+=o[224|f>>12]+o[128|63&f>>6]+o[128|63&f];continue}h+=1,f=65536+((1023&f)<<10|1023&e.charCodeAt(h)),g+=o[240|f>>18]+o[128|63&f>>12]+o[128|63&f>>6]+o[128|63&f]}return g},isBuffer:function(a){return null!==a&&"undefined"!=typeof a&&!!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a))},isRegExp:function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},merge:function a(b,c,d){if(!c)return b;if("object"!=typeof c){if(Array.isArray(b))b.push(c);else if("object"==typeof b)(d&&(d.plainObjects||d.allowPrototypes)||!n.call(Object.prototype,c))&&(b[c]=!0);else return[b,c];return b}if("object"!=typeof b)return[b].concat(c);var e=b;return Array.isArray(b)&&!Array.isArray(c)&&(e=q(b,d)),Array.isArray(b)&&Array.isArray(c)?(c.forEach(function(c,e){n.call(b,e)?b[e]&&"object"==typeof b[e]?b[e]=a(b[e],c,d):b.push(c):b[e]=c}),b):Object.keys(c).reduce(function(b,e){var f=c[e];return b[e]=n.call(b,e)?a(b[e],f,d):f,b},e)}},s=String.prototype.replace,t=/%20/g,u={default:"RFC3986",formatters:{RFC1738:function(a){return s.call(a,t,"+")},RFC3986:function(a){return a}},RFC1738:"RFC1738",RFC3986:"RFC3986"},v={brackets:function(a){return a+"[]"},indices:function(a,b){return a+"["+b+"]"},repeat:function(a){return a}},w=Array.isArray,x=Array.prototype.push,y=function(a,b){x.apply(a,w(b)?b:[b])},z=Date.prototype.toISOString,A={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,indices:!1,serializeDate:function(a){return z.call(a)},skipNulls:!1,strictNullHandling:!1},B=function a(b,c,d,e,f,g,h,j,k,l,m,n,o){var p=b;if("function"==typeof h?p=h(c,p):p instanceof Date&&(p=l(p)),null===p){if(e)return g&&!n?g(c,A.encoder,o):c;p=""}if("string"==typeof p||"number"==typeof p||"boolean"==typeof p||r.isBuffer(p)){if(g){var q=n?c:g(c,A.encoder,o);return[m(q)+"="+m(g(p,A.encoder,o))]}return[m(c)+"="+m(p+"")]}var s=[];if("undefined"==typeof p)return s;var t;if(Array.isArray(h))t=h;else{var u=Object.keys(p);t=j?u.sort(j):u}for(var v,w=0;w<t.length;++w)(v=t[w],!(f&&null===p[v]))&&(Array.isArray(p)?y(s,a(p[v],d(c,v),d,e,f,g,h,j,k,l,m,n,o)):y(s,a(p[v],c+(k?"."+v:"["+v+"]"),d,e,f,g,h,j,k,l,m,n,o)));return s},C=function(a,b){var c=a,d=b?r.assign({},b):{};if(null!==d.encoder&&void 0!==d.encoder&&"function"!=typeof d.encoder)throw new TypeError("Encoder has to be a function.");var e="undefined"==typeof d.delimiter?A.delimiter:d.delimiter,f="boolean"==typeof d.strictNullHandling?d.strictNullHandling:A.strictNullHandling,g="boolean"==typeof d.skipNulls?d.skipNulls:A.skipNulls,h="boolean"==typeof d.encode?d.encode:A.encode,j="function"==typeof d.encoder?d.encoder:A.encoder,k="function"==typeof d.sort?d.sort:null,l="undefined"==typeof d.allowDots?A.allowDots:!!d.allowDots,m="function"==typeof d.serializeDate?d.serializeDate:A.serializeDate,n="boolean"==typeof d.encodeValuesOnly?d.encodeValuesOnly:A.encodeValuesOnly,o=d.charset||A.charset;if("undefined"!=typeof d.charset&&"utf-8"!==d.charset&&"iso-8859-1"!==d.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if("undefined"==typeof d.format)d.format=u["default"];else if(!Object.prototype.hasOwnProperty.call(u.formatters,d.format))throw new TypeError("Unknown format option provided.");var p,q,s=u.formatters[d.format];"function"==typeof d.filter?(q=d.filter,c=q("",c)):Array.isArray(d.filter)&&(q=d.filter,p=q);var t=[];if("object"!=typeof c||null===c)return"";var w=d.arrayFormat in v?d.arrayFormat:"indices"in d?d.indices?"indices":"repeat":"indices";var x=v[w];p||(p=Object.keys(c)),k&&p.sort(k);for(var z,C=0;C<p.length;++C)(z=p[C],!(g&&null===c[z]))&&y(t,B(c[z],z,x,f,g,h?j:null,q,k,l,m,s,n,o));var D=t.join(e),E=!0===d.addQueryPrefix?"?":"";return d.charsetSentinel&&("iso-8859-1"===o?E+="utf8=%26%2310003%3B&":E+="utf8=%E2%9C%93&"),0<D.length?E+D:""},D=Object.prototype.hasOwnProperty,E={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},F=function(a){return a.replace(/&#(\d+);/g,function(a,b){return j(parseInt(b,10))})},G=function(a,b){var c,d={},e=b.ignoreQueryPrefix?a.replace(/^\?/,""):a,f=b.parameterLimit===1/0?void 0:b.parameterLimit,g=e.split(b.delimiter,f),h=-1,j=b.charset;if(b.charsetSentinel)for(c=0;c<g.length;++c)0===g[c].indexOf("utf8=")&&(g[c]==="utf8=%E2%9C%93"?j="utf-8":g[c]==="utf8=%26%2310003%3B"&&(j="iso-8859-1"),h=c,c=g.length);for(c=0;c<g.length;++c)if(c!==h){var k,l,m=g[c],n=m.indexOf("]="),o=-1===n?m.indexOf("="):n+1;-1===o?(k=b.decoder(m,E.decoder,j),l=b.strictNullHandling?null:""):(k=b.decoder(m.slice(0,o),E.decoder,j),l=b.decoder(m.slice(o+1),E.decoder,j)),l&&b.interpretNumericEntities&&"iso-8859-1"===j&&(l=F(l)),d[k]=D.call(d,k)?r.combine(d[k],l):l}return d},H=function(a,b,c){for(var d=b,e=a.length-1;0<=e;--e){var f,g=a[e];if("[]"===g&&c.parseArrays)f=[].concat(d);else{f=c.plainObjects?Object.create(null):{};var h="["===g.charAt(0)&&"]"===g.charAt(g.length-1)?g.slice(1,-1):g,j=parseInt(h,10);c.parseArrays||""!==h?!isNaN(j)&&g!==h&&j+""===h&&0<=j&&c.parseArrays&&j<=c.arrayLimit?(f=[],f[j]=d):f[h]=d:f={0:d}}d=f}return d},I=function(a,b,c){if(a){var d=c.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,e=/(\[[^[\]]*])/,f=/(\[[^[\]]*])/g,g=e.exec(d),h=g?d.slice(0,g.index):d,j=[];if(h){if(!c.plainObjects&&D.call(Object.prototype,h)&&!c.allowPrototypes)return;j.push(h)}for(var k=0;null!==(g=f.exec(d))&&k<c.depth;){if(k+=1,!c.plainObjects&&D.call(Object.prototype,g[1].slice(1,-1))&&!c.allowPrototypes)return;j.push(g[1])}return g&&j.push("["+d.slice(g.index)+"]"),H(j,b,c)}},J={formats:u,parse:function(a,b){var c=b?r.assign({},b):{};if(null!==c.decoder&&void 0!==c.decoder&&"function"!=typeof c.decoder)throw new TypeError("Decoder has to be a function.");if(c.ignoreQueryPrefix=!0===c.ignoreQueryPrefix,c.delimiter="string"==typeof c.delimiter||r.isRegExp(c.delimiter)?c.delimiter:E.delimiter,c.depth="number"==typeof c.depth?c.depth:E.depth,c.arrayLimit="number"==typeof c.arrayLimit?c.arrayLimit:E.arrayLimit,c.parseArrays=!1!==c.parseArrays,c.decoder="function"==typeof c.decoder?c.decoder:E.decoder,c.allowDots="undefined"==typeof c.allowDots?E.allowDots:!!c.allowDots,c.plainObjects="boolean"==typeof c.plainObjects?c.plainObjects:E.plainObjects,c.allowPrototypes="boolean"==typeof c.allowPrototypes?c.allowPrototypes:E.allowPrototypes,c.parameterLimit="number"==typeof c.parameterLimit?c.parameterLimit:E.parameterLimit,c.strictNullHandling="boolean"==typeof c.strictNullHandling?c.strictNullHandling:E.strictNullHandling,"undefined"!=typeof c.charset&&"utf-8"!==c.charset&&"iso-8859-1"!==c.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if("undefined"==typeof c.charset&&(c.charset=E.charset),""===a||null===a||"undefined"==typeof a)return c.plainObjects?Object.create(null):{};for(var d="string"==typeof a?G(a,c):a,e=c.plainObjects?Object.create(null):{},f=Object.keys(d),g=0;g<f.length;++g){var h=f[g],j=I(h,d[h],c);e=r.merge(e,j,c)}return r.compact(e)},stringify:C},K=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a){(function(b,c,d){a.exports?a.exports=d():c[b]=d()})("urljoin",m,function(){function a(a){var b=[];if(a[0].match(/^[^/:]+:\/*$/)&&1<a.length){var c=a.shift();a[0]=c+a[0]}a[0]=a[0].match(/^file:\/\/\//)?a[0].replace(/^([^/:]+):\/*/,"$1:///"):a[0].replace(/^([^/:]+):\/*/,"$1://");for(var d,e=0;e<a.length;e++){if(d=a[e],"string"!=typeof d)throw new TypeError("Url must be a string. Received "+d);""!==d&&(0<e&&(d=d.replace(/^[\/]+/,"")),d=e<a.length-1?d.replace(/[\/]+$/,""):d.replace(/[\/]+$/,"/"),b.push(d))}var f=b.join("/");f=f.replace(/\/(\?|&|#[^!])/g,"$1");var g=f.split("?");return f=g.shift()+(0<g.length?"?":"")+g.join("&"),f}return function(){var b;return b="object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments),a(b)}})});const L=(a,b)=>{if(a){const c=b.get(a);!c||--c.count||b.delete(a)}},M=({abortToken:a,signal:b},c,d)=>{if(!a&&!b)return c.signal;let e=new AbortController;if(a){const b=d.get(a)||{controller:e,count:0};b.count++,d.set(a,b),e=b.controller}return b&&b.addEventListener("abort",()=>e.abort()),c.signal.addEventListener("abort",()=>e.abort()),e.signal},N=a=>new Promise(b=>setTimeout(()=>b(),a)),O=(a,b)=>{if("function"!=typeof a)throw new Error(b)},P=async(a,{retries:c=0,retryDelay:d=1e3,retryFn:b})=>{if(O(a,"retry function is not a function"),isNaN(c)||0>c)throw new Error("retries must be a number greater than or equal to 0");if(d&&isNaN(d))throw new Error("retryDelay must be a number (milliseconds)");if(b&&"function"!=typeof b)throw new Error("retryFn must be callable");const e=async a=>b?b(a):N(d);let f=-1;const g=async b=>{try{return f++,await a(f)}catch(a){if(!b)throw a;return await e(a),g(--b)}},h=await g(c);return{count:f,res:h}},Q=async(a,{retries:b,retryDelay:c,retryFn:d,retryOn:f=[],signal:e})=>{if(O(a,"retry function is not a function"),f&&!Array.isArray(f))throw new Error("retryOn must be an array of response statii");if(null!=e&&"boolean"!=typeof e.aborted)throw new Error("signal must have boolean \"aborted\" property");const g=()=>e&&e.aborted,h=()=>{throw new Error("aborted")};return P(async c=>{const d=await a();if(-1===f.indexOf(d.status)||b===c)return d;throw new Error(d)},{retries:b,retryFn:async()=>g()?h():d?d():N(c)})};if("undefined"==typeof fetch)throw new Error("You need a fetch implementation. Try npm install cross-fetch");if("undefined"==typeof AbortController)throw new Error("You're missing an AbortController implementation. Try npm install abortcontroller-polyfill");const R=["GET","POST","PUT","HEAD","OPTIONS","DEL","PATCH"],S=(a,b,c,d)=>{const e={...d,method:"del"===a?"DELETE":a.toUpperCase(),headers:{...(b.headers||{}),...d.headers}};e.headers=Object.keys(e.headers).reduce((a,b)=>{const c=e.headers[b];return c?{[b]:c,...a}:a},{}),e.body||"POST"!==a||(e.body=""),"GET"===a&&e.body&&(c+=`?${J.stringify(e.body,{arrayFormat:b.arrayFormat})}`,delete e.body),e.body&&"object"==typeof e.body&&(e.body=JSON.stringify(e.body));const f=b.baseURI?K(b.baseURI,c):c;return fetch(f,e)},T=(a,b,{path:c,options:d},e,f=0)=>{const{retries:k=0,retryDelay:l=1e3,retryOn:m=[],retryFn:g,abortToken:h,signal:i,...j}=d,n=M({abortToken:h,signal:i},b.abortController,b.abortTokenMap),o={method:a,retryCount:f,call:{path:c,options:{...d},extra:{...e}},retry:()=>(f++,T(a,b,{path:c,options:{...d}},{...e},f))},p=Array.from(b.interceptors),q=p.reduce((a,b)=>(a=a.then(a=>a.slice(0,2).concat([{...e},f])),b.request&&(a=a.then(a=>b.request(...a))),b.requestError&&(a=a.catch(b.requestError)),a),Promise.resolve([c,j])),r=p.reverse().reduce((a,b)=>(b.response&&(a=a.then(b.response)),b.responseError&&(a=a.catch(b.responseError)),a),(async()=>{const[c,d]=await q,{count:e,res:h}=await Q(()=>S(a,b,c,{...d,signal:n}),{retries:k,retryDelay:l,retryOn:m,retryFn:g,signal:n});f+=e,h.flighty=o;let i,j;try{i=await h.clone().json()}catch(a){}try{j=await h.clone().text()}catch(a){}return h.flighty={...o,json:i,text:j},h})());return r.finally(()=>L(h,b.abortTokenMap))};return class{constructor(a={}){R.forEach(a=>this[a.toLowerCase()]=(b="/",c={},d={})=>T(a,this,{path:b,options:c},d));let b;const c=new Set,d=new Map;Object.defineProperties(this,{headers:{get(){return a.headers},set(b={}){a={...a,headers:b}}},arrayFormat:{get(){return a.arrayFormat||"indicies"}},baseURI:{get(){return a.baseURI},set(b){a={...a,baseURI:b}}},interceptors:{get(){return c}},interceptor:{get(){return{register:a=>this.registerInterceptor(a),unregister:a=>this.removeInterceptor(a),clear:()=>this.clearInterceptors()}}},abortController:{get(){return b||(b=new AbortController,b.signal.addEventListener("abort",()=>{b=null})),b}},abortTokenMap:{get(){return d}}})}abort(a){const b=this.abortTokenMap.get(a);return b&&b.controller.abort()}abortAll(){this.abortController.abort()}registerInterceptor(a){if(!a)throw new Error("cannot register a null interceptor");return this.interceptors.add(a),()=>this.interceptors.delete(a)}clearInterceptors(){this.interceptors.clear()}removeInterceptor(a){this.interceptors.delete(a)}jwt(a){return this.headers={...this.headers,Authorization:a?`Bearer ${a}`:null},this}}}();
//# sourceMappingURL=flighty.fetch.min.js.map
