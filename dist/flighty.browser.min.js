"use strict";var flighty=function(){'use strict';var a=Object.prototype.hasOwnProperty,b=function(){for(var a=[],b=0;256>b;++b)a.push("%"+((16>b?"0":"")+b.toString(16)).toUpperCase());return a}(),c=function(a){for(;1<a.length;){var b=a.pop(),c=b.obj[b.prop];if(Array.isArray(c)){for(var d=[],e=0;e<c.length;++e)"undefined"!=typeof c[e]&&d.push(c[e]);b.obj[b.prop]=d}}},d=function(a,b){for(var c=b&&b.plainObjects?Object.create(null):{},d=0;d<a.length;++d)"undefined"!=typeof a[d]&&(c[d]=a[d]);return c},e={arrayToObject:d,assign:function(a,b){return Object.keys(b).reduce(function(a,c){return a[c]=b[c],a},a)},combine:function(c,a){return[].concat(c,a)},compact:function(a){for(var b=[{obj:{o:a},prop:"o"}],d=[],e=0;e<b.length;++e)for(var f=b[e],g=f.obj[f.prop],h=Object.keys(g),k=0;k<h.length;++k){var l=h[k],m=g[l];"object"==typeof m&&null!==m&&-1===d.indexOf(m)&&(b.push({obj:g,prop:l}),d.push(m))}return c(b),a},decode:function(a,b,c){var d=a.replace(/\+/g," ");if("iso-8859-1"===c)return d.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(d)}catch(a){return d}},encode:function(a,d,e){if(0===a.length)return a;var f="string"==typeof a?a:a+"";if("iso-8859-1"===e)return escape(f).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});for(var g,h="",j=0;j<f.length;++j){if(g=f.charCodeAt(j),45===g||46===g||95===g||126===g||48<=g&&57>=g||65<=g&&90>=g||97<=g&&122>=g){h+=f.charAt(j);continue}if(128>g){h+=b[g];continue}if(2048>g){h+=b[192|g>>6]+b[128|63&g];continue}if(55296>g||57344<=g){h+=b[224|g>>12]+b[128|63&g>>6]+b[128|63&g];continue}j+=1,g=65536+((1023&g)<<10|1023&f.charCodeAt(j)),h+=b[240|g>>18]+b[128|63&g>>12]+b[128|63&g>>6]+b[128|63&g]}return h},isBuffer:function(a){return null!==a&&"undefined"!=typeof a&&!!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a))},isRegExp:function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},merge:function b(c,e,f){if(!e)return c;if("object"!=typeof e){if(Array.isArray(c))c.push(e);else if("object"==typeof c)(f&&(f.plainObjects||f.allowPrototypes)||!a.call(Object.prototype,e))&&(c[e]=!0);else return[c,e];return c}if("object"!=typeof c)return[c].concat(e);var g=c;return Array.isArray(c)&&!Array.isArray(e)&&(g=d(c,f)),Array.isArray(c)&&Array.isArray(e)?(e.forEach(function(d,e){a.call(c,e)?c[e]&&"object"==typeof c[e]?c[e]=b(c[e],d,f):c.push(d):c[e]=d}),c):Object.keys(e).reduce(function(c,d){var g=e[d];return c[d]=a.call(c,d)?b(c[d],g,f):g,c},g)}},f=String.prototype.replace,g=/%20/g,h={default:"RFC3986",formatters:{RFC1738:function(a){return f.call(a,g,"+")},RFC3986:function(a){return a}},RFC1738:"RFC1738",RFC3986:"RFC3986"},j={brackets:function(a){return a+"[]"},indices:function(a,b){return a+"["+b+"]"},repeat:function(a){return a}},k=Array.isArray,l=Array.prototype.push,m=function(a,b){l.apply(a,k(b)?b:[b])},n=Date.prototype.toISOString,o={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:e.encode,encodeValuesOnly:!1,indices:!1,serializeDate:function(a){return n.call(a)},skipNulls:!1,strictNullHandling:!1},p=function a(b,c,d,f,g,h,j,k,l,n,p,q,r){var s=b;if("function"==typeof j?s=j(c,s):s instanceof Date&&(s=n(s)),null===s){if(f)return h&&!q?h(c,o.encoder,r):c;s=""}if("string"==typeof s||"number"==typeof s||"boolean"==typeof s||e.isBuffer(s)){if(h){var t=q?c:h(c,o.encoder,r);return[p(t)+"="+p(h(s,o.encoder,r))]}return[p(c)+"="+p(s+"")]}var u=[];if("undefined"==typeof s)return u;var v;if(Array.isArray(j))v=j;else{var w=Object.keys(s);v=k?w.sort(k):w}for(var x,y=0;y<v.length;++y)(x=v[y],!(g&&null===s[x]))&&(Array.isArray(s)?m(u,a(s[x],d(c,x),d,f,g,h,j,k,l,n,p,q,r)):m(u,a(s[x],c+(l?"."+x:"["+x+"]"),d,f,g,h,j,k,l,n,p,q,r)));return u},q=function(a,b){var c=a,d=b?e.assign({},b):{};if(null!==d.encoder&&void 0!==d.encoder&&"function"!=typeof d.encoder)throw new TypeError("Encoder has to be a function.");var f="undefined"==typeof d.delimiter?o.delimiter:d.delimiter,g="boolean"==typeof d.strictNullHandling?d.strictNullHandling:o.strictNullHandling,k="boolean"==typeof d.skipNulls?d.skipNulls:o.skipNulls,l="boolean"==typeof d.encode?d.encode:o.encode,n="function"==typeof d.encoder?d.encoder:o.encoder,q="function"==typeof d.sort?d.sort:null,r="undefined"==typeof d.allowDots?o.allowDots:!!d.allowDots,s="function"==typeof d.serializeDate?d.serializeDate:o.serializeDate,t="boolean"==typeof d.encodeValuesOnly?d.encodeValuesOnly:o.encodeValuesOnly,u=d.charset||o.charset;if("undefined"!=typeof d.charset&&"utf-8"!==d.charset&&"iso-8859-1"!==d.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if("undefined"==typeof d.format)d.format=h["default"];else if(!Object.prototype.hasOwnProperty.call(h.formatters,d.format))throw new TypeError("Unknown format option provided.");var v,w,x=h.formatters[d.format];"function"==typeof d.filter?(w=d.filter,c=w("",c)):Array.isArray(d.filter)&&(w=d.filter,v=w);var y=[];if("object"!=typeof c||null===c)return"";var z=d.arrayFormat in j?d.arrayFormat:"indices"in d?d.indices?"indices":"repeat":"indices";var A=j[z];v||(v=Object.keys(c)),q&&v.sort(q);for(var B,C=0;C<v.length;++C)(B=v[C],!(k&&null===c[B]))&&m(y,p(c[B],B,A,g,k,l?n:null,w,q,r,s,x,t,u));var D=y.join(f),E=!0===d.addQueryPrefix?"?":"";return d.charsetSentinel&&("iso-8859-1"===u?E+="utf8=%26%2310003%3B&":E+="utf8=%E2%9C%93&"),0<D.length?E+D:""},r=Object.prototype.hasOwnProperty,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,decoder:e.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},t=function(a){return a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(parseInt(b,10))})},u=function(a,b){var c,d={},f=b.ignoreQueryPrefix?a.replace(/^\?/,""):a,g=b.parameterLimit===1/0?void 0:b.parameterLimit,h=f.split(b.delimiter,g),j=-1,k=b.charset;if(b.charsetSentinel)for(c=0;c<h.length;++c)0===h[c].indexOf("utf8=")&&(h[c]==="utf8=%E2%9C%93"?k="utf-8":h[c]==="utf8=%26%2310003%3B"&&(k="iso-8859-1"),j=c,c=h.length);for(c=0;c<h.length;++c)if(c!==j){var l,m,n=h[c],o=n.indexOf("]="),p=-1===o?n.indexOf("="):o+1;-1===p?(l=b.decoder(n,s.decoder,k),m=b.strictNullHandling?null:""):(l=b.decoder(n.slice(0,p),s.decoder,k),m=b.decoder(n.slice(p+1),s.decoder,k)),m&&b.interpretNumericEntities&&"iso-8859-1"===k&&(m=t(m)),d[l]=r.call(d,l)?e.combine(d[l],m):m}return d},v=function(a,b,c){for(var d=b,e=a.length-1;0<=e;--e){var f,g=a[e];if("[]"===g&&c.parseArrays)f=[].concat(d);else{f=c.plainObjects?Object.create(null):{};var h="["===g.charAt(0)&&"]"===g.charAt(g.length-1)?g.slice(1,-1):g,j=parseInt(h,10);c.parseArrays||""!==h?!isNaN(j)&&g!==h&&j+""===h&&0<=j&&c.parseArrays&&j<=c.arrayLimit?(f=[],f[j]=d):f[h]=d:f={0:d}}d=f}return d},w=function(a,b,c){if(a){var d=c.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,e=/(\[[^[\]]*])/,f=/(\[[^[\]]*])/g,g=e.exec(d),h=g?d.slice(0,g.index):d,j=[];if(h){if(!c.plainObjects&&r.call(Object.prototype,h)&&!c.allowPrototypes)return;j.push(h)}for(var k=0;null!==(g=f.exec(d))&&k<c.depth;){if(k+=1,!c.plainObjects&&r.call(Object.prototype,g[1].slice(1,-1))&&!c.allowPrototypes)return;j.push(g[1])}return g&&j.push("["+d.slice(g.index)+"]"),v(j,b,c)}},x={formats:h,parse:function(a,b){var c=b?e.assign({},b):{};if(null!==c.decoder&&void 0!==c.decoder&&"function"!=typeof c.decoder)throw new TypeError("Decoder has to be a function.");if(c.ignoreQueryPrefix=!0===c.ignoreQueryPrefix,c.delimiter="string"==typeof c.delimiter||e.isRegExp(c.delimiter)?c.delimiter:s.delimiter,c.depth="number"==typeof c.depth?c.depth:s.depth,c.arrayLimit="number"==typeof c.arrayLimit?c.arrayLimit:s.arrayLimit,c.parseArrays=!1!==c.parseArrays,c.decoder="function"==typeof c.decoder?c.decoder:s.decoder,c.allowDots="undefined"==typeof c.allowDots?s.allowDots:!!c.allowDots,c.plainObjects="boolean"==typeof c.plainObjects?c.plainObjects:s.plainObjects,c.allowPrototypes="boolean"==typeof c.allowPrototypes?c.allowPrototypes:s.allowPrototypes,c.parameterLimit="number"==typeof c.parameterLimit?c.parameterLimit:s.parameterLimit,c.strictNullHandling="boolean"==typeof c.strictNullHandling?c.strictNullHandling:s.strictNullHandling,"undefined"!=typeof c.charset&&"utf-8"!==c.charset&&"iso-8859-1"!==c.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if("undefined"==typeof c.charset&&(c.charset=s.charset),""===a||null===a||"undefined"==typeof a)return c.plainObjects?Object.create(null):{};for(var d="string"==typeof a?u(a,c):a,f=c.plainObjects?Object.create(null):{},g=Object.keys(d),h=0;h<g.length;++h){var j=g[h],k=w(j,d[j],c);f=e.merge(f,k,c)}return e.compact(f)},stringify:q},y="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,z=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a){(function(b,c,d){a.exports?a.exports=d():c[b]=d()})("urljoin",y,function(){function a(a){var b=[];if(a[0].match(/^[^/:]+:\/*$/)&&1<a.length){var c=a.shift();a[0]=c+a[0]}a[0]=a[0].match(/^file:\/\/\//)?a[0].replace(/^([^/:]+):\/*/,"$1:///"):a[0].replace(/^([^/:]+):\/*/,"$1://");for(var d,e=0;e<a.length;e++){if(d=a[e],"string"!=typeof d)throw new TypeError("Url must be a string. Received "+d);""!==d&&(0<e&&(d=d.replace(/^[\/]+/,"")),d=e<a.length-1?d.replace(/[\/]+$/,""):d.replace(/[\/]+$/,"/"),b.push(d))}var f=b.join("/");f=f.replace(/\/(\?|&|#[^!])/g,"$1");var g=f.split("?");return f=g.shift()+(0<g.length?"?":"")+g.join("&"),f}return function(){var b;return b="object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments),a(b)}})});const A=(a,b)=>{if(a){const c=b.get(a);!c||--c.count||b.delete(a)}},B=({abortToken:a,signal:b},c,d)=>{if(!a&&!b)return c.signal;let e=new AbortController;if(a){const b=d.get(a)||{controller:e,count:0};b.count++,d.set(a,b),e=b.controller}return b&&(b.aborted?e.abort():b.addEventListener("abort",()=>e.abort())),c.signal.addEventListener("abort",()=>e.abort()),e.signal},C=a=>new Promise(b=>setTimeout(()=>b(),a)),D=(a,b)=>{if("function"!=typeof a)throw new Error(b)},E=async(a,{retries:c=0,retryDelay:d=1e3,retryFn:b})=>{if(D(a,"retry function is not a function"),isNaN(c)||0>c)throw new Error("retries must be a number greater than or equal to 0");if(d&&isNaN(d))throw new Error("retryDelay must be a number (milliseconds)");if(b&&"function"!=typeof b)throw new Error("retryFn must be callable");const e=async(...a)=>b?b(...a):C(d);let f=-1;const g=async b=>{try{return f++,await a(f)}catch(a){if(!b)throw a;return await e(f+1,a),g(--b)}},h=await g(c);return{count:f,res:h}},F=async(a,{retries:b,retryDelay:c,retryFn:d,retryOn:f=[],signal:e})=>{if(D(a,"retry function is not a function"),f&&!Array.isArray(f))throw new Error("retryOn must be an array of response statii");if(null!=e&&"boolean"!=typeof e.aborted)throw new Error("signal must have boolean \"aborted\" property");return E(async c=>{const d=await a();if(-1===f.indexOf(d.status)||b===c)return d;throw new Error(d)},{retries:b,retryFn:async(a,b)=>{if(e&&e.aborted)throw b;return d?d(a,b):C(c)}})};if("undefined"==typeof fetch||"undefined"==typeof AbortController){let a;throw a="undefined"==typeof fetch?"You're missing a fetch implementation.":"You're missing an AbortController implementation.",new Error(`${a} Try var Flighty = require('flighty/fetch') or import Flighty from 'flighty/fetch'"`)}const G=["GET","POST","PUT","HEAD","OPTIONS","DEL","PATCH"],H=(a,b,c,d)=>{const e={...d,method:"del"===a?"DELETE":a.toUpperCase(),headers:{...(b.headers||{}),...d.headers}};e.headers=Object.keys(e.headers).reduce((a,b)=>{const c=e.headers[b];return c?{[b]:c,...a}:a},{}),e.body||"POST"!==a||(e.body=""),"GET"===a&&e.body&&(c+=`?${x.stringify(e.body,{arrayFormat:b.arrayFormat})}`,delete e.body),e.body&&"object"==typeof e.body&&(e.body=JSON.stringify(e.body));const f=b.baseURI?z(b.baseURI,c):c;return fetch(f,e)},I=(a,b,{path:c,options:d},e,f=0)=>{const{retries:k=0,retryDelay:l=1e3,retryOn:m=[],retryFn:g,abortToken:h,signal:i,...j}=d,n=B({abortToken:h,signal:i},b.abortController,b.abortTokenMap),o={method:a,call:{path:c,options:{...d},extra:{...e}},retry:()=>(f++,I(a,b,{path:c,options:{...d}},{...e},f))},p=Array.from(b.interceptors),q=p.reduce((a,b)=>(a=a.then(a=>a.slice(0,2).concat([{...e},f])),b.request&&(a=a.then(a=>b.request(...a))),b.requestError&&(a=a.catch(b.requestError)),a),Promise.resolve([c,j])),r=p.reverse().reduce((a,b)=>(b.response&&(a=a.then(b.response)),b.responseError&&(a=a.catch(b.responseError)),a),(async()=>{const[c,d]=await q,{count:e,res:h}=await F(()=>H(a,b,c,{...d,signal:n}),{retries:k,retryDelay:l,retryOn:m,retryFn:g,signal:n});f+=e,h.flighty=o;let i,j;try{i=await h.clone().json()}catch(a){}try{j=await h.clone().text()}catch(a){}return h.flighty={...o,retryCount:f,json:i,text:j},h})());return r.finally(()=>A(h,b.abortTokenMap))};return class{constructor(a={}){G.forEach(a=>this[a.toLowerCase()]=(b="/",c={},d={})=>I(a,this,{path:b,options:c},d));let b;const c=new Set,d=new Map;Object.defineProperties(this,{headers:{get(){return a.headers},set(b={}){a={...a,headers:b}}},arrayFormat:{get(){return a.arrayFormat||"indicies"}},baseURI:{get(){return a.baseURI},set(b){a={...a,baseURI:b}}},interceptors:{get(){return c}},interceptor:{get(){return{register:a=>this.registerInterceptor(a),unregister:a=>this.removeInterceptor(a),clear:()=>this.clearInterceptors()}}},abortController:{get(){return b||(b=new AbortController,b.signal.addEventListener("abort",()=>{b=null})),b}},abortTokenMap:{get(){return d}}})}abort(a){const b=this.abortTokenMap.get(a);return b&&b.controller.abort()}abortAll(){this.abortController.abort()}registerInterceptor(a){if(!a)throw new Error("cannot register a null interceptor");return this.interceptors.add(a),()=>this.interceptors.delete(a)}clearInterceptors(){this.interceptors.clear()}removeInterceptor(a){this.interceptors.delete(a)}jwt(a){return this.headers={...this.headers,Authorization:a?`Bearer ${a}`:null},this}}}();
//# sourceMappingURL=flighty.browser.min.js.map
